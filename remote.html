<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SelfBalancingRobot control</title>

    <style>
        * {
            font-family: monospace;
        }

        section {
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <h1>Self Balancing Robot control</h1>
    
    <section>
        <h3>PID gains</h3>
        <p>P: <input type="number" id="kp" placeholder="kp" value="0.5" step="0.01"></p>
        <p>I: <input type="number" id="ki" placeholder="ki" value="0.1" step="0.01"></p>
        <p>D: <input type="number" id="kd" placeholder="kd" value="0.1" step="0.01"></p>
        <button onclick="sendPIDgains()">Send</button>
        <p>Current PID gains: <span id="currentPID"></span></p>
    </section>

    <section>
        <h3>PWM Limits</h3>
        <p>L motor min PWM: <input type="number" id="LminPWM" placeholder="left min PWM" value="80"></p>
        <p>R motor min PWM: <input type="number" id="RminPWM" placeholder="right min PWM" value="80"></p>
        <button onclick="sendPWMlimits()">Send</button>
        <p>Current PWM limits: <span id="currentPWM"></span></p>
    </section>

    <section>
        <h3>Setpoint</h3>
        <p>Setpoint: <input type="number" id="setpoint" placeholder="setpoint" value="0" step="0.005"></p>
        <button onclick="sendSetpoint()">Send</button>
        <p>Current setpoint: <span id="currentSetpoint"></span></p>
    </section>

    <section>
        <h3>Output LPF</h3>
        <p>Alpha: <input type="number" id="alpha" placeholder="alpha" value="0.9", step="0.05"></p>
        <button onclick="sendAlpha()">Send</button>
        <p>Current alpha: <span id="currentAlpha"></span></p>
    </section>
    
    <script>
        function sendPIDgains() {
            var kp = document.getElementById("kp").value;
            var ki = document.getElementById("ki").value;
            var kd = document.getElementById("kd").value;
            fetch(`http://self-balancing-robot.local/settings?p=${kp}&i=${ki}&d=${kd}`)
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                    document.getElementById("currentPID").innerText = data;
                })
                .catch(error => console.error(error));
        }

        function sendPWMlimits() {
            var LminPWM = document.getElementById("LminPWM").value;
            var RminPWM = document.getElementById("RminPWM").value;
            fetch(`http://self-balancing-robot.local/settings?lmin=${LminPWM}&rmin=${RminPWM}`)
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                    document.getElementById("currentPWM").innerText = data;
                })
                .catch(error => console.error(error));
        }

        function sendSetpoint() {
            var setpoint = document.getElementById("setpoint").value;
            fetch(`http://self-balancing-robot.local/settings?setpoint=${setpoint}`)
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                    document.getElementById("currentSetpoint").innerText = data;
                })
                .catch(error => console.error(error));
        }

        function sendAlpha() {
            var alpha = document.getElementById("alpha").value;
            fetch(`http://self-balancing-robot.local/settings?alpha=${alpha}`)
                .then(response => response.text())
                .then(data => {
                    console.log(data);
                    document.getElementById("currentAlpha").innerText = data;
                })
                .catch(error => console.error(error));
        }
    </script>
</body>
</html>